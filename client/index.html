<html>
  <head>
    <meta charset="utf-8" />
    <title>Display a map on a webpage</title>
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.css"
      rel="stylesheet"
    />
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/Turf.js/6.5.0/turf.min.js"
      integrity="sha512-Q7HOppxoH0L2M7hreVoFCtUZimR2YaY0fBewIYzkCgmNtgOOZ5IgMNYxHgfps0qrO1ef5m7L1FeHrhXlq1I9HA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      #map {
        position: absolute;
        top: 100;
        bottom: 100;
        width: 80%;
        height: 80%;
      }
    </style>
  </head>
  <body>
    <label>
      <input type="checkbox" onchange="toggleLandCover(this)" />Landcover
    </label>
    <label> <input type="checkbox" onchange="toggleHydro(this)" />Hydro </label>
    <label> <input type="checkbox" onchange="toggleSoil(this)" />Soil </label>
    <div id="map"></div>
    <script>
      const toggleLandCover = (cb) => {
        if (cb.checked) {
          map.addLayer({
            id: "test-vector-layer-landcover",
            type: "fill",
            source: "landcover-vector",
            // "source-layer": "landcover",
            "source-layer": "geojsonLayer",
            paint: {
              "fill-color": "green",
              "fill-opacity": 0.7,
            },
            filter: ["==", ["get", "transect_feature_type"], "landcover"],
          });
        } else {
          map.removeLayer("test-vector-layer-landcover");
        }
      };
      const toggleHydro = (cb) => {
        if (cb.checked) {
          map.addLayer({
            id: "test-vector-layer-hydro",
            type: "fill",
            source: "hydrography-vector",
            "source-layer": "geojsonLayer",
            // "source-layer": "hydrography",
            paint: {
              "fill-color": "red",
              "fill-opacity": 0.7,
            },
            filter: ["==", ["get", "transect_feature_type"], "hydrography"],
          });
        } else {
          map.removeLayer("test-vector-layer-hydro");
        }
      };
      const toggleSoil = (cb) => {
        if (cb.checked) {
          map.addLayer({
            id: "test-vector-layer-soil",
            type: "fill",
            source: "soil-vector",
            // "source-layer": "soil",
            "source-layer": "geojsonLayer",
            paint: {
              "fill-color": "pink",
              "fill-opacity": 0.4,
            },
            filter: ["==", ["get", "transect_feature_type"], "soil"],
          });
        } else {
          map.removeLayer("test-vector-layer-soil");
        }
      };
      const aoi = {
        type: "Polygon",
        coordinates: [
          [
            [-97.9230247019844, 29.564137700727],
            [-97.938626340119, 29.3940107295051],
            [-97.6020767174967, 29.3862414798855],
            [-97.5931614957055, 29.5874028237309],
            [-97.8316436786231, 29.6145386945022],
            [-97.9230247019844, 29.564137700727],
          ],
        ],
      };
      const bbox = turf.bbox(aoi);
      mapboxgl.accessToken =
        "pk.eyJ1IjoidW1hcm11bmVlcjIwMTAiLCJhIjoiY2tta2dkcnI3MTB3YzJ1czcwd2dyejVqaSJ9.ba-W1B5R71tQ2vBK6ee8tA";
      const map = new mapboxgl.Map({
        container: "map", // container ID
        style: "mapbox://styles/mapbox/streets-v11", // style URL
        center: [-97.833637, 29.59581], // starting position [lng, lat]
        zoom: 14, // starting zoom
      });
      map.on("load", () => {
        map.fitBounds(bbox);
        map.addSource("aoi", {
          type: "geojson",
          data: aoi,
        });
        map.addLayer({
          id: "aoi-layer",
          source: "aoi",
          type: "line",
          layout: {},
          paint: {
            "line-color": "#c01b1b",
            "line-width": 3,
          },
        });
        map.addSource("landcover-vector", {
          type: "vector",
          // tiles: ["http://34.65.111.18:3005/vt/{z}/{x}/{y}?layer=landcover"],
          tiles: [
            "http://localhost:3005/in-mem/vt/{z}/{x}/{y}?layer=landcover&reportPartId=6f9d62b9-5c18-4629-868a-d458eed8539b",
          ],
          minzoom: 2,
          maxzoom: 14,
        });
        map.addSource("soil-vector", {
          type: "vector",
          // tiles: ["http://34.65.111.18:3005/vt/{z}/{x}/{y}?layer=soil"],
          tiles: [
            "http://localhost:3005/in-mem/vt/{z}/{x}/{y}?layer=soil&reportPartId=7ff04055-d10f-42d9-b0c1-0af5f8bd66ec",
          ],
          minzoom: 2,
          maxzoom: 14,
        });
        map.addSource("hydrography-vector", {
          type: "vector",
          // tiles: ["http://34.65.111.18:3005/vt/{z}/{x}/{y}?layer=hydrography"],
          tiles: [
            "http://localhost:3005/in-mem/vt/{z}/{x}/{y}?layer=hydrography&reportPartId=b25d6532-2f01-4889-8a93-6b517223c88b",
          ],
          minzoom: 2,
          maxzoom: 14,
        });
      });
    </script>
  </body>
</html>
